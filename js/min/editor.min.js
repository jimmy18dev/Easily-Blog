function FileSize(t){return t>max_filesize?!1:!0}function FileType(t){switch(t){case"pdf":case"txt":case"doc":case"docx":case"ppt":case"pptx":case"xls":case"xlsx":case"zip":break;default:return!1}return!0}var article_api="api/article",youtube_key="AIzaSyB5KfCVIK9XviNJ9fNYWwAGhZfRskjGQ_M",max_filesize=$("#maximumSize").val();$(document).ready(function(){function t(t){switch($title=$("#editorTitle"),$icon=$("#editorIcon"),t){case"editing":$title.html("แก้ไข"),$icon.html('<i class="fa fa-keyboard-o" aria-hidden="true"></i>');break;case"fail":$title.html("ลองอีกครั้ง!"),$progressbar.animate({width:"0%"},500),$progressbar.fadeOut();break;case"progress":$title.html("กำลังบันทึก..."),$icon.html('<i class="fa fa-spinner fa-spin" aria-hidden="true"></i>'),$progressbar.fadeIn(300),$progressbar.width("0%"),$progressbar.animate({width:"70%"},500);break;case"complete":$progressbar.animate({width:"100%"},500),$progressbar.fadeOut(function(){$title.html("บันทึกแล้ว"),$icon.html('<i class="fa fa-check-circle" aria-hidden="true"></i>')});break;default:$title.html("เขียนบทความ")}}function e(t){var e=t.match(/(?:https?:\/{2})?(?:w{3}\.)?youtu(?:be)?\.(?:com|be)(?:\/watch\?v=|\/)([^\s&]+)/);return null!=e?e[1]:0}$(".autosize").autosize({append:"\n"}),tippy("[title]",{arrow:!0});var o=$("#article_id").val(),i=new Article(o);$(document).click(function(t){$(t.target).is(".between-option")||($(".more-option").fadeOut(100),$overlay.removeClass("open")),$(t.target).is("#swap")||$(t.target).is(".fa-sort")||$("#swap").removeClass("-toggle")}),$title=$("#title"),setTimeout(function(){var t=$("#original_title").val();$title.val(t).trigger("input"),document.title=0==t.length?"ตั้งชื่อบทความ":t},0);var n;$title.on({input:function(){var t=$(this).val();document.title=0==t.length?"ตั้งชื่อบทความ":$(this).val()},focus:function(){n=$(this).val()},blur:function(){var t=$(this).val();return n==t?!1:(i.editTitle(t),document.title=t,void 0)}}),$btnAction=$(".btnAction"),$btnAction.click(function(){var t=$(this).attr("data-action"),e=$(this).attr("data-content");return t?($.ajax({url:article_api,cache:!1,dataType:"json",type:"POST",data:{request:"create_content",article_id:o,content_id:e,type:t},error:function(t){console.log(t.responseText)}}).done(function(t){console.log(t);var e=t.content_id,o=window.location.pathname+"#content"+e;console.log(o),window.location.href=o,window.location.reload(!0)}),void 0):!1}),$("#btn-publish").click(function(){$(this).html('<span>กำลังเผยแพร่</span><i class="fa fa-spinner fa-spin" aria-hidden="true"></i>'),i.publish(),setTimeout(function(){window.location="article/"+o},1e3)}),$("#btn-remove").click(function(){return confirm("คุณต้องการลบบทความใช่หรือไม่ ?")?(i.remove(),setTimeout(function(){window.location="profile"},1e3),void 0):!1}),$("#btn-draft").click(function(){return confirm("คุณต้องการยกเลิกเผยแพร่บทความนี้ ใช่หรือไม่ ?")?(i.draft(),setTimeout(function(){location.reload()},1e3),void 0):!1});var a,r,c;$topic=$(".topic"),$topic.focus(function(){a=$(this).val(),t("editing")}),$topic.blur(function(){var e=$(this).parent().attr("data-content"),o=$(this).val();return a==o?(t(),!1):(t("progress"),i.editTopic(e,o),void 0)}),$(".lat").on("input",function(){var e=$(this).parent().attr("data-content"),o=$(this).val(),n=$(this).parent().children(".lng").val();t("progress"),i.editLocation(e,o,n)}),$body=$(".body"),$body.focus(function(){r=$(this).val(),t("editing")}),$body.blur(function(){var e=$(this).parent().attr("data-content"),o=$(this).val();return r==o?(t(),!1):(t("progress"),i.editBody(e,o),void 0)}),$alt=$(".alt"),$alt.focus(function(){c=$(this).val(),t("editing")}),$alt.blur(function(){var e=$(this).parent().attr("data-content"),o=$(this).val();return c==o?(t(),!1):(t("progress"),i.editAlt(e,o),void 0)});var l;$YouTubeURL=$(".youtube_url"),$YouTubeURL.focus(function(){var t=$(this).parent().attr("data-content");$YouTubeID=$("#content"+t).children(".youtube_id"),l=$YouTubeID.val(),console.log(l)}),$YouTubeURL.on("input",function(){var t=$(this).parent().attr("data-content");$YouTubeID=$("#content"+t).children(".youtube_id");var o=$(this).val(),i=e(o);if(l==i)return console.log("YouTube ID Not Change!"),!1;if(0!=i&&11==i.length){$YouTubePreview=$("#content"+t).children(".videoWrapper"),$YouTubeAlt=$("#content"+t).children(".alt"),$YouTubeID.val(i);var n='<iframe src="https://www.youtube.com/embed/'+i+'?rel=0&amp;controls=0&amp;showinfo=0"></iframe>';$YouTubePreview.html(n),$YouTubePreview.fadeIn(300),$YouTubeAlt.fadeIn(300);var a="https://www.googleapis.com/youtube/v3/videos?part=snippet&id="+i+"&key="+youtube_key;$.getJSON(a,function(t){if(console.log(t.items.length,t),0!=t.items.length){var e=t.items[0].snippet.title;console.log(e)}else console.log("Video not found!")})}}),$YouTubeURL.blur(function(){var o=$(this).parent().attr("data-content");$YouTubeID=$("#content"+o).children(".youtube_id");var n=$(this).val(),a=e(n);return 0==a||11!=a.length?!1:(t("progress"),i.editVideo(o,a),void 0)});var s;$(".btn-choose-image").click(function(){s=$(this).parent().parent().parent().attr("data-content"),console.log("btn choose image clicked! with content "+s),$("#imageFiles"+s).focus().click()}),$(".btn-change-image").click(function(){s=$(this).parent().parent().attr("data-content"),$("#imageFiles"+s).focus().click()}),$(".image-file").change(function(){$imagePreview=$("#imagePreview"+s),$imageForm=$("#content"+s),console.log("content "+s);var t=this.files;$imagePreview.html("");var e=t[0],o=/image.*/;console.log("file",e),e.type.match(o)||console.log("Not an Image");var i=document.createElement("img");i.file=e,$imagePreview.append(i);var n=new FileReader;n.onload=function(t){return function(e){t.src=e.target.result}}(i);var a=(n.readAsDataURL(e),document.createElement("canvas"));ctx=a.getContext("2d"),i.onload=function(){ctx.drawImage(i,100,100)},$imageForm.submit()}),$photoForm=$(".content"),$photoLoading=null,$photoLoadingBar=null,$photoAlt=null,$photoForm.ajaxForm({beforeSubmit:function(){$photoLoading=$("#loading"+s),$photoLoadingBar=$("#bar"+s),$photoAlt=$("#alt"+s),$photoLoading.fadeIn(300),$photoForm.clearForm()},uploadProgress:function(t,e,o,i){var n=i;n=80*n/100,$photoLoadingBar.animate({width:n+"%"},100),console.log("Upload: "+i+" %")},success:function(){$photoLoadingBar.animate({width:"100%"},300)},complete:function(t){console.log(t.responseJSON),$photoAlt.fadeIn(300),$photoLoading.fadeOut(300)}}),$btnDeleteContent=$(".btnDeleteContent"),$btnDeleteContent.click(function(){var t=$(this).parent().parent().attr("data-content");return confirm("Delete this Content #"+t+" ?")?(i.deleteContent(t),$("#content"+t).fadeOut(500),void 0):!1}),$(".between-option").click(function(){$moreOption=$(this).children(".more-option"),$overlay.addClass("open"),$moreOption.fadeIn(300)}),$(".btn-rotate-image").click(function(){s=$(this).parent().parent().attr("data-content"),$img=$("#imagePreview"+s).children("img"),document.querySelector("#imagePreview"+s).scrollIntoView({behavior:"smooth"}),t("progress"),i.imageRotate(s),$img.attr("src",$img.attr("src")+"?"+100*Math.random())}),$(".btn-swap").click(function(){$("#swap").addClass("-toggle"),$("#swapFilter").fadeIn(300);var t=$("#article_id").val();s=$(this).parent().parent().attr("data-content"),$.ajax({url:article_api,cache:!1,dataType:"json",type:"GET",data:{request:"get",article_id:t},error:function(t,e,o){console.log(t,e,o)}}).done(function(t){console.log(t),$("#swap").html(""),$.each(t.dataset.contents,function(t,e){var o="";if(s==e.id&&(o="-active"),"textbox"==e.type)var i=$('<div class="swap-items text '+o+'" data-id="'+e.id+'">'+e.body+"</div>");else if("image"==e.type)var i=$('<div class="swap-items '+o+'" data-id="'+e.id+'"><img src="image/upload/thumbnail/'+e.img_location+'"></div>');else if("youtube"==e.type)var i=$('<div class="swap-items '+o+'" data-id="'+e.id+'"><img src="http://img.youtube.com/vi/'+e.message+'/mqdefault.jpg"></div>');$("#swap").append(i)})}),$("#swapFilter").click(function(){$(this).fadeOut(300),$("#swap").removeClass("-toggle")})}),$("#swap").on("click",".swap-items",function(){var t=$(this).attr("data-id");return console.log(s,t),s==t?!1:(i.swapContent(s,t),void 0)}),$documentForm=$("#documentForm"),$btnAttachFile=$("#btnAttachFile"),$fileName=$("#fileName"),$fileInput=$("#file"),$documentProgress=$("#documentProgress"),$documentProgressBar=$("#documentProgressBar"),$btnAttachFile.click(function(){$fileInput.focus().click()}),$fileInput.change(function(){var t=this.files,e=t[0],o=e.size,i=(e.name.substring(0,e.name.lastIndexOf(".")),e.name.substring(e.name.lastIndexOf(".")+1));return FileType(i)?FileSize(o)?($fileName.html(e.name),$documentForm.submit(),void 0):(alert("ไฟล์ของคุณมีขนาด "+numeral(o).format("0.0 b")+" ซึ่งต้องไม่เกิน "+max_filesize/1048576+" MB"),location.reload(),!1):(alert("ระบบยังไม่รองรับไฟล์ประเภท ."+i),location.reload(),!1)}),$documentForm.ajaxForm({beforeSubmit:function(t){if(!t[0].value)return console.log("File input is empty!"),!1;var e=t[0].value.name,o=t[0].value.size,i=e.substring(e.lastIndexOf(".")+1),n=t[1].value;return FileSize(o)?FileType(i)?n&&e?($documentForm.fadeIn(300),$documentProgress.fadeIn(300),$documentProgressBar.width("0%"),void 0):!1:!1:!1},uploadProgress:function(t,e,o,i){var n=i;n=80*n/100,$documentProgressBar.animate({width:n+"%"},0)},success:function(){$documentProgressBar.animate({width:"90%"},100)},complete:function(t){if(console.log(t.responseText),t.responseJSON){{t.responseJSON.file_id}$documentProgressBar.animate({width:"100%"},300,function(){location.reload()})}else alert("ไฟล์ของคุณไม่สามารถอัพโหลดเข้าระบบได้ กรุณาติดต่อผู้ดูแลระบบ"),location.reload()}});var u;$document=$(".file_title"),$document.focus(function(){u=$(this).val(),t("editing")}),$document.blur(function(){var e=$(this).parent().parent().attr("data-file"),o=$(this).val();return u==o?(t(),!1):(t("progress"),i.editDocTitle(e,o),void 0)}),$(".btn-doc-delete").click(function(){var t=$(this).parent().attr("data-file"),e=$(this).parent().children(".detail").children(".file_title").val();return $thisItems=$(this).parent(),confirm('คุณต้องการลบ "'+e+'" ใช่หรือไม่ ?')?(i.deleteDoc(t),$thisItems.fadeOut(300),void 0):!1})});