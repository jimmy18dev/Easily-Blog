var article_api="api/article";$(document).ready(function(){autosize($("textarea"));var t,e,o=$("#article_id").val();$(document).click(function(t){$(t.target).is(".between-option")||$(".more-option").fadeOut(100)}),$articleTitle=$("#articleTitle"),$articleTitle.focus(function(){t=$(this).val()}),$articleTitle.blur(function(){var e=$(this).val();return t==e?!1:($.ajax({url:article_api,cache:!1,dataType:"json",type:"POST",data:{request:"edit_title",article_id:o,title:e},error:function(t){console.log(t.responseText)}}).done(function(t){console.log(t)}),void 0)}),$articleDescription=$("#articleDescription"),$articleDescription.focus(function(){e=$(this).val()}),$articleDescription.blur(function(){var t=$(this).val();return e==t?!1:($.ajax({url:article_api,cache:!1,dataType:"json",type:"POST",data:{request:"edit_description",article_id:o,description:t},error:function(t){console.log(t.responseText)}}).done(function(t){console.log(t)}),void 0)}),$btnAction=$(".btnAction"),$btnAction.click(function(){var t=$(this).attr("data-action"),e=$(this).attr("data-content");console.log(o),$.ajax({url:article_api,cache:!1,dataType:"json",type:"POST",data:{request:"create_content",article_id:o,content_id:e,type:t},error:function(t){console.log(t.responseText)}}).done(function(t){console.log(t),location.reload()})});var n,a,i;$topicInput=$(".topic-input"),$topicInput.focus(function(){n=$(this).val()}),$topicInput.blur(function(){var t=$(this).parent().attr("data-content"),e=$(this).val();return console.log(n),console.log(e),n==e?!1:($.ajax({url:article_api,cache:!1,dataType:"json",type:"POST",data:{request:"edit_topic",article_id:o,content_id:t,topic:e},error:function(t){console.log(t.responseText)}}).done(function(t){console.log(t)}),void 0)}),$bodyInput=$(".body-input"),$bodyInput.focus(function(){a=$(this).val()}),$bodyInput.blur(function(){var t=$(this).parent().attr("data-content"),e=$(this).val();return a==e?!1:($.ajax({url:article_api,cache:!1,dataType:"json",type:"POST",data:{request:"edit_body",article_id:o,content_id:t,body:e},error:function(t){console.log(t.responseText)}}).done(function(t){console.log(t)}),void 0)}),$imageAlt=$(".image-alt"),$imageAlt.focus(function(){i=$(this).val()}),$imageAlt.blur(function(){var t=$(this).parent().attr("data-content"),e=$(this).val();return i==e?!1:($.ajax({url:article_api,cache:!1,dataType:"json",type:"POST",data:{request:"edit_img_alt",article_id:o,content_id:t,img_alt:e},error:function(t){console.log(t.responseText)}}).done(function(t){console.log(t)}),void 0)});var c;$(".btn-choose-image").click(function(){c=$(this).parent().parent().parent().attr("data-content"),console.log("btn choose image clicked! with content "+c),$("#imageFiles"+c).focus().click()}),$(".btn-change-image").click(function(){c=$(this).parent().parent().attr("data-content"),$("#imageFiles"+c).focus().click()}),$(".image-file").change(function(){$imagePreview=$("#imagePreview"+c),$imageForm=$("#imageForm"+c),console.log("content "+c);var t=this.files;$imagePreview.html("");var e=t[0],o=/image.*/;console.log("file",e),e.type.match(o)||console.log("Not an Image");var n=document.createElement("img");n.file=e,$imagePreview.append(n);var a=new FileReader;a.onload=function(t){return function(e){t.src=e.target.result}}(n);var i=(a.readAsDataURL(e),document.createElement("canvas"));ctx=i.getContext("2d"),n.onload=function(){ctx.drawImage(n,100,100)},$imageForm.submit()}),$photoForm=$(".photoForm"),$photoLoading=null,$photoLoadingBar=null,$photoForm.ajaxForm({beforeSubmit:function(){$photoLoading=$("#loading"+c),$photoLoadingBar=$("#bar"+c),$photoLoading.fadeIn(300),$photoForm.clearForm()},uploadProgress:function(t,e,o,n){var a=n;a=80*a/100,$photoLoadingBar.animate({width:a+"%"},100),console.log("Upload: "+n+" %")},success:function(){$photoLoadingBar.animate({width:"100%"},300)},complete:function(t){console.log(t.responseJSON),$photoLoading.fadeOut(300)}}),$btnDeleteContent=$(".btnDeleteContent"),$btnDeleteContent.click(function(){var t=$(this).parent().parent().attr("data-content");return confirm("Delete this Content #"+t+" ?")?($.ajax({url:article_api,cache:!1,dataType:"json",type:"POST",data:{request:"delete_content",article_id:o,content_id:t},error:function(t){console.log(t.responseText)}}).done(function(t){console.log(t),location.reload()}),void 0):!1}),$(".between-option").click(function(){$moreOption=$(this).children(".more-option"),$moreOption.fadeIn(300)}),$(".btn-rotate-image").click(function(){c=$(this).parent().parent().attr("data-content"),$img=$("#imagePreview"+c).children("img"),console.log($img),$.ajax({url:article_api,cache:!1,dataType:"json",type:"POST",data:{request:"rotate_image",content_id:c},error:function(t){console.log(t.responseText)}}).done(function(t){console.log(t),$img.attr("src",$img.attr("src")+"?"+100*Math.random())})})});