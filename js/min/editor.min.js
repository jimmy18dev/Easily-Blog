function FileSize(e){return e>max_filesize?!1:!0}function FileType(e){switch(e){case"pdf":case"txt":case"doc":case"docx":case"ppt":case"pptx":case"xls":case"xlsx":case"zip":break;default:return!1}return!0}var article_api="api/article",youtube_key="AIzaSyB5KfCVIK9XviNJ9fNYWwAGhZfRskjGQ_M",max_filesize=$("#maximumSize").val();$(document).ready(function(){function e(e){"saved"==e?$("#editor-status").html('<i class="fal fa-check"></i>'):$("#editor-status").html("")}function t(e){var t=e.match(/(?:https?:\/{2})?(?:w{3}\.)?youtu(?:be)?\.(?:com|be)(?:\/watch\?v=|\/)([^\s&]+)/);return null!=t?t[1]:0}$(".autosize").autosize({append:"\n"}),tippy("[title]",{arrow:!0});var o=$("#article_id").val(),n=new Article(o);$("#btnChooseCover").click(function(){$("#coverImageFiles").focus().click()}),$("#btnRemoveCover").click(function(){return confirm("คุณต้องการลบภาพหน้าปก ใช่หรือไม่ ?")?(n.removeHeadCover(),void 0):!1}),$("#coverImageFiles").change(function(){$("#coverForm").submit()}),$("#coverForm").ajaxForm({beforeSubmit:function(){$("#btnChooseCover").html("กำลังอัพโหลด...")},uploadProgress:function(e,t,o,n){var a=n;a=85*a/100,console.clear(),console.log("Upload: "+a+" %"),$progressbar.Progressbar(a+"%")},success:function(){console.clear(),$progressbar.Progressbar("85%")},complete:function(e){$progressbar.Progressbar("99.99%"),console.log(e.responseJSON),location.reload()}}),$("#btnMultipleImages").click(function(){$("#multipleImageFiles").focus().click()}),$("#multipleImageFiles").change(function(){$("#multipleImagesForm").submit()}),$("#multipleImagesForm").ajaxForm({beforeSubmit:function(){},uploadProgress:function(e,t,o,n){var a=n;a=80*a/100,console.log("Upload: "+n+" %"),$progressbar.Progressbar(n+"%")},success:function(){},complete:function(e){console.log(e.responseJSON),location.reload()}}),$(document).click(function(e){$(e.target).is(".between-option")||($(".more-option").fadeOut(100),$overlay.removeClass("open"))}),$title=$("#title"),setTimeout(function(){var e=$("#original_title").val();$title.val(e).trigger("input"),document.title=0==e.length?"ตั้งชื่อบทความ":e},0);var a;$title.on({input:function(){var e=$(this).val();document.title=0==e.length?"ตั้งชื่อบทความ":$(this).val()},focus:function(){a=$(this).val(),e()},blur:function(){var t=$(this).val();return a==t?!1:(n.editTitle(t),document.title=t,e("saved"),void 0)}}),$btnAction=$(".btnAction"),$btnAction.click(function(){var e=$(this).attr("data-action"),t=$(this).attr("data-content");return e?($.ajax({url:article_api,cache:!1,dataType:"json",type:"POST",data:{request:"create_content",article_id:o,content_id:t,type:e},error:function(e){console.log(e.responseText)}}).done(function(e){console.log(e);var t=e.content_id,o=window.location.pathname+"#content"+t;console.log(o),window.location.href=o,window.location.reload(!0)}),void 0):!1}),$("#btn-publish").click(function(){$(this).removeClass("active"),n.publish(),setTimeout(function(){window.location="article/"+o},1e3)}),$("#btn-remove").click(function(){return confirm("คุณต้องการลบบทความใช่หรือไม่ ?")?(n.remove(),setTimeout(function(){window.location="profile"},1e3),void 0):!1}),$("#btn-draft").click(function(){return confirm("คุณต้องการยกเลิกเผยแพร่บทความนี้ ใช่หรือไม่ ?")?(n.draft(),setTimeout(function(){location.reload()},1e3),void 0):!1});var i,r,l;$topic=$(".topic"),$topic.focus(function(){i=$(this).val(),e()}),$topic.blur(function(){var t=$(this).parent().attr("data-content"),o=$(this).val();return i==o?!1:(n.editTopic(t,o),e("saved"),void 0)}),$(".lat").on("input",function(){var t=$(this).parent().attr("data-content"),o=$(this).val(),a=$(this).parent().children(".lng").val();e("save"),n.editLocation(t,o,a)}),$body=$(".body"),$body.focus(function(){r=$(this).val(),e()}),$body.blur(function(){var t=$(this).parent().attr("data-content"),o=$(this).val();return r==o?!1:(e("saved"),n.editBody(t,o),void 0)}),$alt=$(".alt"),$alt.focus(function(){l=$(this).val(),e()}),$alt.blur(function(){var t=$(this).parent().attr("data-content"),o=$(this).val();return l==o?!1:(e("saved"),n.editAlt(t,o),void 0)});var c;$YouTubeURL=$(".youtube_url"),$YouTubeURL.focus(function(){var t=$(this).parent().parent().attr("data-content");$YouTubeID=$("#content"+t).children(".youtube_id"),c=$YouTubeID.val(),e(),console.log(c)}),$YouTubeURL.on("input",function(){var e=$(this).parent().parent().attr("data-content");$YouTubeID=$("#content"+e).children(".youtube_id");var o=$(this).val(),n=t(o);if(c==n)return console.log("YouTube ID Not Change!"),!1;if(0!=n&&11==n.length){$YouTubePreview=$("#content"+e).children(".videoWrapper"),$YouTubeAlt=$("#content"+e).children(".alt"),$YouTubeID.val(n);var a='<iframe src="https://www.youtube.com/embed/'+n+'?rel=0&amp;controls=0&amp;showinfo=0"></iframe>';$YouTubePreview.html(a),console.log($YouTubePreview,a),$YouTubePreview.fadeIn(300),$YouTubeAlt.fadeIn(300);var i="https://www.googleapis.com/youtube/v3/videos?part=snippet&id="+n+"&key="+youtube_key;$.getJSON(i,function(e){if(console.log(e.items.length,e),0!=e.items.length){var t=e.items[0].snippet.title;console.log(t)}else console.log("Video not found!")})}}),$YouTubeURL.blur(function(){var o=$(this).parent().parent().attr("data-content");$YouTubeID=$("#content"+o).children(".youtube_id");var a=$(this).val(),i=t(a);return 0==i||11!=i.length?!1:(n.editVideo(o,i),e("saved"),void 0)});var s;$(".btn-choose-image").click(function(){s=$(this).parent().parent().parent().attr("data-content"),console.log("btn choose image clicked! with content "+s),$("#imageFiles"+s).focus().click()}),$(".btn-change-image").click(function(){s=$(this).parent().parent().attr("data-content"),$("#imageFiles"+s).focus().click()}),$(".image-file").change(function(){$imagePreview=$("#imagePreview"+s),$imageForm=$("#content"+s),console.log("content "+s);var e=this.files;$imagePreview.html("");var t=e[0],o=/image.*/;console.log("file",t),t.type.match(o)||console.log("Not an Image");var n=document.createElement("img");n.file=t,$imagePreview.append(n);var a=new FileReader;a.onload=function(e){return function(t){e.src=t.target.result}}(n);var i=(a.readAsDataURL(t),document.createElement("canvas"));ctx=i.getContext("2d"),n.onload=function(){ctx.drawImage(n,100,100)},$imageForm.submit()}),$photoForm=$(".content"),$photoLoading=null,$photoLoadingBar=null,$photoAlt=null,$photoForm.ajaxForm({beforeSubmit:function(){$photoLoading=$("#loading"+s),$photoLoadingBar=$("#bar"+s),$photoAlt=$("#alt"+s),$photoLoading.fadeIn(300),$photoForm.clearForm()},uploadProgress:function(e,t,o,n){var a=n;a=80*a/100,console.clear(),$photoLoadingBar.animate({width:a+"%"},100),console.log("Upload: "+n+" %")},success:function(){$photoLoadingBar.animate({width:"100%"},300)},complete:function(e){console.log(e.responseText),console.log(e.responseJSON),$photoAlt.fadeIn(300),$photoLoading.fadeOut(300)}}),$btnDeleteContent=$(".btnDeleteContent"),$btnDeleteContent.click(function(){var e=$(this).parent().parent().attr("data-content");return confirm("Delete this Content #"+e+" ?")?(n.deleteContent(e),location.reload(),void 0):!1}),$(".between-option").click(function(){$moreOption=$(this).children(".more-option"),$overlay.addClass("open"),$moreOption.fadeIn(300)}),$(".btn-rotate-image").click(function(){s=$(this).parent().parent().attr("data-content"),$img=$("#imagePreview"+s).children("img"),document.querySelector("#imagePreview"+s).scrollIntoView({behavior:"smooth"}),n.imageRotate(s),$img.attr("src",$img.attr("src")+"?"+100*Math.random()),e("saved")}),$(".btn-swap").click(function(){$("#swap").addClass("-toggle"),$("#overlay").addClass("open");var e=$("#article_id").val();s=$(this).parent().parent().attr("data-content"),$.ajax({url:article_api,cache:!1,dataType:"json",type:"GET",data:{request:"get",article_id:e},error:function(e,t,o){console.log(e,t,o)}}).done(function(t){console.log(t),$("#swap").html(""),$.each(t.dataset.contents,function(t,o){var n="";if(s==o.id&&(n="-active"),"textbox"==o.type)var a=$('<div class="swap-items text '+n+'" data-id="'+o.id+'">'+o.body+"</div>");else if("image"==o.type)var a=$('<div class="swap-items '+n+'" data-id="'+o.id+'"><img src="image/upload/'+e+"/thumbnail/"+o.img_location+'"></div>');else if("youtube"==o.type)var a=$('<div class="swap-items '+n+'" data-id="'+o.id+'"><img src="http://img.youtube.com/vi/'+o.message+'/mqdefault.jpg"></div>');$("#swap").append(a)})}),$("#overlay").click(function(){$(this).removeClass("open"),$("#swap").removeClass("-toggle"),$("#swap").html("")})}),$("#swap").on("click",".swap-items",function(){var e=$(this).attr("data-id");return console.log(s,e),s==e?!1:(n.swapContent(s,e),void 0)}),$documentForm=$("#documentForm"),$btnAttachFile=$("#btnAttachFile"),$fileName=$("#fileName"),$fileInput=$("#file"),$btnAttachFile.click(function(){$fileInput.focus().click()}),$fileInput.change(function(){var e=this.files,t=e[0],o=t.size,n=(t.name.substring(0,t.name.lastIndexOf(".")),t.name.substring(t.name.lastIndexOf(".")+1));return FileType(n)?FileSize(o)?($fileName.html(t.name),$documentForm.submit(),void 0):(alert("ไฟล์ของคุณมีขนาด "+numeral(o).format("0.0 b")+" ซึ่งต้องไม่เกิน "+max_filesize/1048576+" MB"),location.reload(),!1):(alert("ระบบยังไม่รองรับไฟล์ประเภท ."+n),location.reload(),!1)}),$documentForm.ajaxForm({beforeSubmit:function(e){if(!e[0].value)return console.log("File input is empty!"),!1;var t=e[0].value.name,o=e[0].value.size,n=t.substring(t.lastIndexOf(".")+1),a=e[1].value;return FileSize(o)?FileType(n)?a&&t?void 0:!1:!1:!1},uploadProgress:function(e,t,o,n){var a=n;a=85*a/100,console.clear(),console.log("Upload: "+a+" %"),$progressbar.Progressbar(a+"%")},success:function(){$progressbar.Progressbar("99%")},complete:function(e){if(console.log(e.responseText),e.responseJSON){{e.responseJSON.file_id}location.reload()}else alert("ไฟล์ของคุณไม่สามารถอัพโหลดเข้าระบบได้ กรุณาติดต่อผู้ดูแลระบบ"),location.reload()}});var u;$document=$(".file_title"),$document.focus(function(){u=$(this).val(),e()}),$document.blur(function(){var t=$(this).parent().parent().attr("data-file"),o=$(this).val();return u==o?!1:(n.editDocTitle(t,o),e("saved"),void 0)}),$(".btn-doc-delete").click(function(){var e=$(this).parent().attr("data-file"),t=$(this).parent().children(".detail").children(".file_title").val();return $thisItems=$(this).parent(),confirm('คุณต้องการลบ "'+t+'" ใช่หรือไม่ ?')?(n.deleteDoc(e),$thisItems.fadeOut(300),void 0):!1})});