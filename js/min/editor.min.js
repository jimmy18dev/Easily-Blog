var article_api="api/article",youtube_key="AIzaSyB5KfCVIK9XviNJ9fNYWwAGhZfRskjGQ_M";$(document).ready(function(){function t(t){switch($title=$("#editorTitle"),t){case"editing":$title.html("[แก้ไข]");break;case"fail":$title.html("ลองอีกครั้ง!"),$progressbar.animate({width:"0%"},500),$progressbar.fadeOut();break;case"progress":$title.html("กำลังบันทึก..."),$progressbar.fadeIn(300),$progressbar.width("0%"),$progressbar.animate({width:"70%"},500);break;case"complete":$progressbar.animate({width:"100%"},500),$progressbar.fadeOut(function(){$title.html("บันทึกแล้ว")});break;default:$title.html("เขียนบทความ")}}function e(t){var e=t.match(/(?:https?:\/{2})?(?:w{3}\.)?youtu(?:be)?\.(?:com|be)(?:\/watch\?v=|\/)([^\s&]+)/);return null!=e?e[1]:0}$(".autosize").autosize({append:"\n"}),$("#btnPublish").click(function(){console.log("btnPublish click"),$("#publishPanel").fadeIn(300)}),$("#btnProfile").click(function(){$("#profilePanel").fadeIn(300)}),$(document).click(function(t){$(t.target).is(".between-option")||$(".more-option").fadeOut(100),$(t.target).is("#swap")||$(t.target).is(".fa-sort")||$("#swap").removeClass("-toggle")}),$("#btn-publish").click(function(){$progressbar.fadeIn(300),$progressbar.width("0%"),$progressbar.animate({width:"70%"},500),$.ajax({url:article_api,cache:!1,dataType:"json",type:"POST",data:{request:"change_status",article_id:n,status:"publish"},error:function(t){console.log(t.responseText)}}).done(function(t){console.log(t),$progressbar.animate({width:"100%"},500),$progressbar.fadeOut()})});var o,a,n=$("#article_id").val();$title=$("#title"),setTimeout(function(){var t=$("#original_title").val();$title.val(t).trigger("input")},0),$title.focus(function(){o=$(this).val(),t("editing")}),$title.blur(function(){var e=$(this).val();return o==e?(t(),!1):(t("progress"),$.ajax({url:article_api,cache:!1,dataType:"json",type:"POST",data:{request:"edit_title",article_id:n,title:e},error:function(t){console.log(t.responseText)}}).done(function(e){console.log(e),t("complete")}),void 0)}),$description=$("#description"),$description.focus(function(){a=$(this).val(),t("editing")}),$description.blur(function(){var e=$(this).val();return a==e?(t(),!1):(t("progress"),$.ajax({url:article_api,cache:!1,dataType:"json",type:"POST",data:{request:"edit_description",article_id:n,description:e},error:function(t){console.log(t.responseText)}}).done(function(e){console.log(e),t("complete")}),void 0)}),$btnAction=$(".btnAction"),$btnAction.click(function(){var t=$(this).attr("data-action"),e=$(this).attr("data-content");$.ajax({url:article_api,cache:!1,dataType:"json",type:"POST",data:{request:"create_content",article_id:n,content_id:e,type:t},error:function(t){console.log(t.responseText)}}).done(function(t){console.log(t);var e=t.content_id,o=window.location.pathname+"#content"+e;console.log(o),window.location.href=o,window.location.reload(!0)})});var i,r,c;$topic=$(".topic"),$topic.focus(function(){i=$(this).val(),t("editing")}),$topic.blur(function(){var e=$(this).parent().attr("data-content"),o=$(this).val();return i==o?(t(),!1):(t("progress"),$.ajax({url:article_api,cache:!1,dataType:"json",type:"POST",data:{request:"edit_topic",article_id:n,content_id:e,topic:o},error:function(t){console.log(t.responseText)}}).done(function(e){console.log(e),t("complete")}),void 0)}),$body=$(".body"),$body.focus(function(){r=$(this).val(),t("editing")}),$body.blur(function(){var e=$(this).parent().attr("data-content"),o=$(this).val();return r==o?(t(),!1):(t("progress"),$.ajax({url:article_api,cache:!1,dataType:"json",type:"POST",data:{request:"edit_body",article_id:n,content_id:e,body:o},error:function(t){console.log(t.responseText)}}).done(function(e){console.log(e),t("complete")}),void 0)}),$alt=$(".alt"),$alt.focus(function(){c=$(this).val(),t("editing")}),$alt.blur(function(){var e=$(this).parent().attr("data-content"),o=$(this).val();return c==o?(t(),!1):(t("progress"),$.ajax({url:article_api,cache:!1,dataType:"json",type:"POST",data:{request:"edit_img_alt",article_id:n,content_id:e,img_alt:o},error:function(t){console.log(t.responseText)}}).done(function(e){console.log(e),t("complete")}),void 0)});var l;$youtube=$(".youtube_id"),$youtube.focus(function(){l=$(this).val(),t("editing"),console.log("Youtube ID Focused")}),$youtube.keyup(function(){var t=$(this).parent().attr("data-content"),o=$(this).val();if(console.log("Youtube Link"+o),$YouTubePreview=$("#content"+t).children(".videoWrapper"),o==l)return!1;var a=e(o),n='<iframe src="https://www.youtube.com/embed/'+a+'?rel=0&amp;controls=0&amp;showinfo=0"></iframe>';0!=a&&11==a.length&&($YouTubePreview.html(n),console.log("video_id",a),$.getJSON("https://www.googleapis.com/youtube/v3/videos?part=snippet&id="+a+"&key="+youtube_key,function(t){var e=t.items[0].snippet.title;console.log(e)})),youtube_url=o});var s;$(".btn-choose-image").click(function(){s=$(this).parent().parent().parent().attr("data-content"),console.log("btn choose image clicked! with content "+s),$("#imageFiles"+s).focus().click()}),$(".btn-change-image").click(function(){s=$(this).parent().parent().attr("data-content"),$("#imageFiles"+s).focus().click()}),$(".image-file").change(function(){$imagePreview=$("#imagePreview"+s),$imageForm=$("#content"+s),console.log("content "+s);var t=this.files;$imagePreview.html("");var e=t[0],o=/image.*/;console.log("file",e),e.type.match(o)||console.log("Not an Image");var a=document.createElement("img");a.file=e,$imagePreview.append(a);var n=new FileReader;n.onload=function(t){return function(e){t.src=e.target.result}}(a);var i=(n.readAsDataURL(e),document.createElement("canvas"));ctx=i.getContext("2d"),a.onload=function(){ctx.drawImage(a,100,100)},$imageForm.submit()}),$photoForm=$(".content"),$photoLoading=null,$photoLoadingBar=null,$photoForm.ajaxForm({beforeSubmit:function(){$photoLoading=$("#loading"+s),$photoLoadingBar=$("#bar"+s),$photoLoading.fadeIn(300),$photoForm.clearForm()},uploadProgress:function(t,e,o,a){var n=a;n=80*n/100,$photoLoadingBar.animate({width:n+"%"},100),console.log("Upload: "+a+" %")},success:function(){$photoLoadingBar.animate({width:"100%"},300)},complete:function(t){console.log(t.responseJSON),$photoLoading.fadeOut(300)}}),$btnDeleteContent=$(".btnDeleteContent"),$btnDeleteContent.click(function(){var t=$(this).parent().parent().attr("data-content");return confirm("Delete this Content #"+t+" ?")?($.ajax({url:article_api,cache:!1,dataType:"json",type:"POST",data:{request:"delete_content",article_id:n,content_id:t},error:function(t){console.log(t.responseText)}}).done(function(e){console.log(e),$("#content"+t).fadeOut(500)}),void 0):!1}),$(".between-option").click(function(){$moreOption=$(this).children(".more-option"),$moreOption.fadeIn(300)}),$(".btn-rotate-image").click(function(){s=$(this).parent().parent().attr("data-content"),$img=$("#imagePreview"+s).children("img"),document.querySelector("#imagePreview"+s).scrollIntoView({behavior:"smooth"}),t("progress"),$.ajax({url:article_api,cache:!1,dataType:"json",type:"POST",data:{request:"rotate_image",content_id:s},error:function(t){console.log(t.responseText)}}).done(function(e){console.log(e),$img.attr("src",$img.attr("src")+"?"+100*Math.random()),t("complete")})}),$(".btn-swap").click(function(){$("#swap").addClass("-toggle"),$("#swapFilter").fadeIn(300);var t=$("#article_id").val();s=$(this).parent().parent().attr("data-content"),$.ajax({url:article_api,cache:!1,dataType:"json",type:"GET",data:{request:"get",article_id:t},error:function(t,e,o){console.log(t,e,o)}}).done(function(t){console.log(t),$("#swap").html(""),$.each(t.dataset.contents,function(t,e){var o="";if(s==e.id&&(o="-active"),"textbox"==e.type)var a=$('<div class="swap-items text '+o+'" data-id="'+e.id+'">'+e.body+"</div>");else if("image"==e.type)var a=$('<div class="swap-items '+o+'" data-id="'+e.id+'"><img src="image/upload/thumbnail/'+e.img_location+'"></div>');else if("youtube"==e.type)var a=$('<div class="swap-items '+o+'" data-id="'+e.id+'"><img src="http://img.youtube.com/vi/'+e.message+'/mqdefault.jpg"></div>');$("#swap").append(a)})}),$("#swapFilter").click(function(){$(this).fadeOut(300),$("#swap").removeClass("-toggle")})}),$("#swap").on("click",".swap-items",function(){var t=$(this).attr("data-id");return console.log(s,t),s==t?!1:($.ajax({url:article_api,cache:!1,dataType:"json",type:"POST",data:{request:"swap_content",current_id:s,target_id:t},error:function(t){console.log(t.responseText)}}).done(function(){location.reload()}),void 0)})});